<div>
    <div class="h-[300px] mb-[40px] bg-skyblue hero">
        <img class="w-full h-full object-cover" src="/public/img/banners/unloaded.png">
    </div>
    
    <div class="max-w-[1130px] mx-auto mb-[40px] px-7 lg:px-14 content">
        <h1 class="mb-[40px] text-2xl font-bold">Show title</h1>
        
        <div class="mb-[60px] flex flex-col gap-[20px] player">
            <div class="flex gap-[20px] player-otions">
                <select-input class="w-[150px]" label="Player" :items="this.players" :return-value="v => v.value" :return-text="t => t.text" cv-model="currentPlayer" />
                <select-input class="w-[150px]" label="Épisode" :items="this.episodes" :return-value="v => v.value" :return-text="t => t.text" cv-model="currentEpisode" />
            </div>

            <div class="w-full aspect-video bg-white player-video">
                <iframe width="100%" height="100%" src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            </div>

            <div class="flex justify-between player-bottom">
                <h2 class="text-xl font-bold">Episode title</h2>

                <div class="flex gap-[10px] player-controls">
                    <button class="px-[20px] py-[10px] text-white bg-skyblue rounded">Précédent</button>
                    <button class="px-[20px] py-[10px] text-white bg-skyblue rounded">Suivant</button>
                </div>
            </div>
        </div>

        <div class="comments-section">
            <add_comment @add-comment="refreshComment" class="mb-[40px]" />

            <div cv-if="this.comments.length" class="flex flex-col gap-[20px] comments">
                <comment cv-for="comment of this.comments" :comment="this.comment" />
            </div>
        </div>
    </div>
</div>

<script>
    const [{default: taob}, add_comment, comment] = await Promise.all([
        import("/public/cuteVue/taob.js"),
        importer('/public/cuteVue/components/add_comment.html'),
        importer('/public/cuteVue/components/comment.html')
    ]);

    export default {
        components: {
            add_comment,
            comment
        },

        data: {
            type: null,
            players: [],
            episodes: [],
            currentPlayer: "player1",
            currentEpisode: 1,
            comments: [],
        },

        methods: {
            async init(){
                if(router.pathname.startsWith("/movies")){
                    await taob
                    this.type = "movie";
                }
                else {
                    this.type = "serie";
                }
            },

            async getComments(){
                this.success = false;
                await taob.get("/video/{id}/comment", {params: {id: 1}, loader: true}) // TODO: Change the video id
                .s((data) => {
                    this.success = true;
                    this.comments = data;
                })
                .e(() => {
                    alert("Une erreur est survenue lors du chargement des commentaires");
                })
                .result;
            },

            async refreshComment(comment){
                this.comments.push(comment);
                this.$update("comments");
            },
        },

        mounted(){
            this.init();
            this.getComments();
        }
    }
</script>

<style>

</style>