<div class="max-w-[1164px] h-[calc(100vh-100px)] pt-[20px] mx-auto px-7 lg:px-14 content">
    <span cv-if="this.users.length === 0">Aucun utilisateur trouvé.</span>
    <delete_modal :show="this.isDeleteModalOpen"></delete_modal>
    <user_edit_modal :show="this.isOpenedModal"></user_edit_modal>

    <div class="table w-full" cv-if="this.users.length !== 0">
        <div class="table-header w-full flex justify-between items-center">
            <button class="px-[20px] py-[10px] rounded-[8px] bg-midblue text-white mb-[20px] flex items-center">
                <span class="mdi mdi-plus text-2xl"></span>Ajouter un utilisateur
            </button>

            <div class="search-bar border rounded-[8px] px-[20px] py-[10px] flex items-center">
                <span class="mdi mdi-magnify text-xl mr-[10px]"></span>
                <input class="focus:outline-none" type="text" placeholder="Rechercher">
            </div>
        </div>

        <table class="table-content w-full text-left border-2 rounded-t-[8px]">
            <thead class="bg-whitesmoke">
                <tr>
                    <th class="p-[22px]">Prénom<span class="mdi mdi-arrow-down-thick ml-[8px]"></span></th>
                    <th class="p-[22px]">Nom<span class="mdi mdi-arrow-down-thick ml-[8px]"></span></th>
                    <th class="p-[22px]">Username<span class="mdi mdi-arrow-down-thick ml-[8px]"></span></th>
                    <th class="p-[22px]">Email<span class="mdi mdi-arrow-down-thick ml-[8px]"></span></th>
                    <th class="p-[22px]">Rôle<span class="mdi mdi-arrow-down-thick ml-[8px]"></span></th>
                    <th class="p-[22px]">Actions</th>
                </tr>
            </thead>

            <tbody>
                <tr class="border-2" cv-for="user of this.users">
                    <td class="p-[22px]">{{ this.user.firstname }}</td>
                    <td class="p-[22px]">{{ this.user.lastname }}</td>
                    <td class="p-[22px]">{{ this.user.username }}</td>
                    <td class="p-[22px]">{{ this.user.email }}</td>
                    <td class="p-[22px]">{{ this.user.role === undefined ? "utilisateur" : this.user.role.name }}</td>
                    <td class="p-[22px]">
                        <span class="mdi mdi-trash-can-outline text-2xl cursor-pointer" @click="this.openDeleteModal()"></span>
                        <span class="mdi mdi-pencil-outline text-2xl ml-[14px] cursor-pointer" @click="this.openEditModal()"></span>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <div class="table-footer w-full flex items-center justify-between px-[25px] border-x-[2px] border-b-[2px] p-[12px] rounded-b-[8px]">
            <button @click="this.previousPage()" class="px-[20px] py-[10px] border rounded-[8px]">Précédant</button>
            <span>Page {{ this.currentPageNumber }} sur {{ this.maxPage }}</span>
            <button @click="this.nextPage()" class="px-[20px] py-[10px] border rounded-[8px]">Suivant</button>
        </div>
    </div>
</div>

<script>
    const [impLoader, impTaob] = await Promise.all([
        import("/public/cuteVue/loader.js"),
        import("/public/cuteVue/taob.js")
    ]);
    const loaderStore = impLoader.loaderStore;
    const taob = impTaob.default;

    const [delete_modal, user_edit_modal] = await Promise.all([
        importer('/public/cuteVue/components/delete_modal.html'),
        importer('/public/cuteVue/components/user_edit_modal.html')
    ]);

    export default {
        components: {
            delete_modal,
            user_edit_modal
        },
        data: {
            users: [],
            currentPageNumber: 1,
            maxPage: 10,
            isOpenedModal: false,
            isDeleteModalOpen: false
        },
        methods: {
            async getUsers() {
                let close = loaderStore.push();

                await taob.get("/users").s(data => {
                    this.users = data.users;
                }).result;

                close();
            },
            previousPage() {
                if (this.currentPageNumber === 1) return;
                this.currentPageNumber--;
            },
            nextPage() {
                if (this.currentPageNumber === this.maxPage) return;
                this.currentPageNumber++;
            },
            openEditModal() {
                this.isOpenedModal = true;
            },
            closeEditModal() {
                this.isOpenedModal = false;
            },
            openDeleteModal() {
                this.isDeleteModalOpen = true;
            },
            closeDeleteModal() {
                this.isDeleteModalOpen = false;
            }
        },
        mounted() {
            this.getUsers();
        }
    }
</script>

<style>

</style>