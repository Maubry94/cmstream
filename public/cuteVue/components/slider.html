<div class="w-full h-full flex flex-col items-center h-[500px]">
    <h2 cv-if="this.options.title" class="mb-[20px] self-start text-lg font-bold">{{ this.options.title }}</h2>

    <div class="relative w-full h-full overflow-hidden flex items-center wrapper">
        <div class="prev-btn" @click="this.currentSlide--">
            <icon name="chevron-left"/>
        </div>
        <div
        class="slides-container" 
        cv-style="{'transform': `translateX(-${this.slideWidth * this.currentSlide}px)`}"
        >
            <router_link 
            cv-ref="slides" 
            class="slide relative" 
            cv-for="content of Object.entries(this.contents)" 
            cv-class="{'active': this.content[0] == this.currentSlide}"
            :test="this.currentSlide + ':' + this.content[0]"
            cv-style="{'left': this.content[0] * 100 + '%'}"
            :href="(this.content[1].type === 'M' ? '/movie/' : '/serie/')  + this.content[1].value.id"
            >
                <img class="w-full h-full object-cover pointer-events-none" :src="this.content[1].value.image">

                <div class="absolute bottom-[50px] left-[25px] w-1/3 max-h-[150px] px-[10px] py-[5px] flex flex-col gap-[10px] bg-[rgba(0,0,0,0.5)] content">
                    <h2 class="text-[40px] text-ellipsis overflow-hidden">{{ this.content[1].value.title }}</h2>
    
                    <p class="w-full description">{{ this.content[1].value.description || "" }}</p>
                </div>
            </router_link>
        </div>
        <div class="next-btn" @click="this.currentSlide++">
            <icon name="chevron-right"/>
        </div>
    </div>
    
    <div class="navigation-dots">
        <div 
        cv-for="key of Object.keys(this.contents)" 
        @click="this.currentSlide = this.key"
        class="single-dot"
        cv-class="{'active': this.key == this.currentSlide}"
        />
    </div>
</div>

<script>
    const [impTaob] = await Promise.all([
        import("/public/cuteVue/taob.js")
    ]);

    const taob = impTaob.default;

    export default {
        props: {
            options: null,
        },
        data: {
            slideWidth: 0,
            currentSlide: 0,
            switchDelay: 10000,
            interval: null,
            contents: [],
        },

        watch: {
            async currentSlide(n){
                this.updateWidth();
                if(n === -1) this.currentSlide = this.contents.length-1;
                else if(n === this.contents.length) this.currentSlide = 0;
            } 
        },

        methods: {
            init(){
                taob.get(this.options.url, {query: this.options.query}).s(data => this.contents = data);
            },
            updateWidth(){
                this.slideWidth = this.$refs.slides?.[0]?.clientWidth || 0;
            },
        },

        mounted(){
            this.interval = setInterval(() => {
                this.currentSlide++;
            }, this.switchDelay);

            window.addEventListener("resize", this.updateWidth);

            this.init();
        },

        unmounted(){
            clearInterval(this.interval);
            window.removeEventListener("resize", this.updateWidth);
        },
    }
</script>

<style>
    .wrapper {
        width: 100%;
        position: relative;
        overflow: hidden;
    }

    .slides-container {
        width: 100%;
        height: 500px;
        position: relative;
        transition: 900ms cubic-bezier(0.48, 0.15, 0.18, 1)
    }

    .slide {
        height: 100%;
        width: 100%;
        position: absolute;
    }

    .slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }


    .slide .description {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3; /* number of lines to show */
        -webkit-box-orient: vertical;
    }

    .next-btn,
    .prev-btn {
        padding: 16px;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 20px;
        background-color: #FFFFFF;
        color: #5499C7;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        z-index: 5;
        cursor: pointer;
        transition: 400ms;
    }

    .next-btn:hover,
    .prev-btn:hover {
        background-color: #DADADA;
        color: #5499C7
    }

    .prev-btn {
        left: 0;
    }

    .next-btn {
        right: 0;
    }

    .navigation-dots {
        display: flex;
        height: 32px;
        align-items: center;
        justify-content: center;
        margin: 16px 0;
        margin-top: -50px;
    }

    .single-dot {
        z-index: 5;
        height: 16px;
        width: 16px;
        margin: 0 8px;
        border: 2px solid #000000;
        border-radius: 50%;
        cursor: pointer;
        transition: 400ms;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);

    }

    .single-dot.active {
        background-color: #FFFFFF;
    }
</style>